<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>My Availability • NAT20 Scheduling</title>
  <link rel="icon" href="/assets/favicon.ico" type="image/x-icon">
  <link rel="stylesheet" href="/styles/common.css" />
  <link rel="stylesheet" href="/styles/availability_picker.css" />
  <style>
    /* small page-specific tweaks */
    .page-shell { width: min(var(--container-max, 1200px), 96vw); margin: 16px auto 40px; padding: 0 var(--gutter); }
    .breadcrumbs { display:flex; align-items:center; gap:8px; color:#9ecbff; }
    .breadcrumbs a { color:#9ecbff; text-decoration:none; }
    .header-row { display:flex; justify-content:space-between; align-items:center; margin: 8px 0 12px; }
    .title { font-weight:700; }
    .week-and-help { display:flex; align-items:center; gap:16px; color:#aaa; }
    .week-and-help #week-label { color:#fff; font-weight:600; }
  </style>
</head>
<body>
  <!-- Modal host reused by login/register -->
  <div id="modal-overlay" style="display:none;">
    <div id="modal-container"></div>
  </div>

  <!-- Top bar -->
  <header class="top-bar">
    <div class="top-left">
      <a href="/">&larr; Home</a>
      <h1 class="title">My Availability</h1>
    </div>
    <div class="user-info">
      <span id="user-label" class="user-label" style="display:none;"></span>
      <button id="auth-button">Login</button>
    </div>
  </header>

  <main class="page-shell">
    <nav class="breadcrumbs">
      <a href="/">Home</a>
      <span>›</span>
      <span>My Availability</span>
    </nav>

    <div class="header-row">
      <div class="week-and-help">
        <span id="week-label"></span>
        <span>Shift+Scroll = Vertical Zoom, Scroll = Pan</span>
      </div>
    </div>

    <!-- Controls -->
    <div class="controls">
      <button id="prev-week">Previous week</button>
      <button id="next-week">Next week</button>
      <button id="mode-add" class="active">Add</button>
      <button id="mode-subtract">Subtract</button>
      <button id="save">Save</button>
    </div>

    <!-- Grid -->
    <section id="grid" class="grid" style="height: var(--grid-height);">
      <div id="grid-content" class="grid-content">
        <table id="schedule-table" class="table" aria-label="Weekly availability grid"></table>
        <!-- NOW marker injected -->
      </div>
    </section>

    <!-- Tooltip shown when not signed in -->
    <div id="signin-tooltip" class="signin-tooltip">Sign in to edit your availability</div>
  </main>

  <!-- Scripts -->
  <script src="/scripts/lib/httpClient.js"></script>
  <script src="/scripts/login.js"></script>
  <script src="/scripts/register.js"></script>
  <script src="/scripts/availability_picker.js"></script>

  <script>
    // ---- Modal helpers (reused across pages) ----
    function openModal(path) {
      const overlay = document.getElementById('modal-overlay');
      const container = document.getElementById('modal-container');
      fetch(path, { cache: 'no-cache' })
        .then((res) => res.text())
        .then((html) => {
          container.innerHTML = html;
          overlay.style.display = 'flex';
          document.body.classList.add('modal-active');
          if (path.includes('register.html') && window.initRegisterForm) window.initRegisterForm();
          if (path.includes('login.html') && window.initLoginForm) window.initLoginForm();
        });
    }
    function swapModal(path) { openModal(path); }
    function closeModal() {
      const overlay = document.getElementById('modal-overlay');
      overlay.style.display = 'none';
      document.body.classList.remove('modal-active');
      const container = document.getElementById('modal-container');
      container.innerHTML = '';
    }
    window.openModal = openModal;
    window.swapModal = swapModal;
    window.closeModal = closeModal;

    // ---- Page init ----
    document.addEventListener('DOMContentLoaded', async () => {
      await checkAuth();                // sets header + schedule auth gate
      if (window.schedule && window.schedule.init) {
        window.schedule.init();         // builds the table/grid
      }
    });
  </script>
</body>
</html>
